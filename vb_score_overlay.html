<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>VB Score Overlay</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#050814;
      --card:#050814ee;
      --card-inner:#0a0f23ee;
      --accent:#f7c43a;
      --accent-soft:#f7c43a22;
      --text:#f5f7ff;
      --muted:#8b92b3;
      --serve:#45d56b;
      --badge:#161d36;
      --radius-lg:22px;
      --radius-pill:999px;
      --font:"SF Pro Display","Inter",-apple-system,BlinkMacSystemFont,system-ui,sans-serif;
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:var(--font);}
    body{
      background:transparent;
      color:var(--text);
      overflow:hidden;
    }
    .root{
      position:fixed;
      top:24px;
      left:24px;
      transform-origin:top left;
    }
    .score-card{
      background:var(--card);
      border-radius:var(--radius-lg);
      padding:6px;
      box-shadow:0 18px 45px rgba(0,0,0,.85);
      border:1px solid #141a30;
      width:540px;
    }
    .score-inner{
      background:var(--card-inner);
      border-radius:18px;
      padding:10px 14px 10px 16px;
    }
    .header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:8px;
      font-size:13px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:var(--muted);
    }
    .header-title{font-weight:500;}
    .header-right{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .live-pill{
      border-radius:var(--radius-pill);
      padding:2px 10px;
      border:1px solid #26314d;
      font-size:11px;
      letter-spacing:.16em;
      text-transform:uppercase;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .live-dot{
      width:6px;
      height:6px;
      border-radius:50%;
      background:#ff4949;
      box-shadow:0 0 8px rgba(255,73,73,.9);
    }
    .teams{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .team-row{
      display:grid;
      grid-template-columns:auto 1fr auto auto;
      align-items:center;
      gap:10px;
      padding:6px 8px;
      border-radius:14px;
      background:rgba(4,7,18,.9);
    }
    .pill-code{
      width:48px;
      height:36px;
      border-radius:12px;
      background:var(--accent);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:14px;
      letter-spacing:.18em;
      color:#111321;
      font-weight:700;
    }
    .logo-box{
      width:34px;
      height:34px;
      border-radius:11px;
      background:#070b18;
      border:1px solid #222840;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }
    .logo-box img{
      max-width:100%;
      max-height:100%;
      object-fit:contain;
    }
    .team-name{
      display:flex;
      flex-direction:column;
      justify-content:center;
      padding-left:4px;
    }
    .team-name-short{
      font-size:15px;
      letter-spacing:.22em;
      text-transform:uppercase;
      font-weight:700;
    }
    .sets-pill{
      border-radius:var(--radius-pill);
      background:#070b18;
      border:1px solid #20263c;
      padding:4px 11px;
      display:flex;
      align-items:center;
      gap:6px;
      font-size:11px;
      text-transform:uppercase;
      color:var(--muted);
    }
    .sets-label{letter-spacing:.16em;}
    .sets-value{
      font-size:15px;
      color:var(--text);
      font-weight:600;
    }
    .score-box{
      width:80px;
      border-radius:16px;
      background:#0b1226;
      padding:4px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:6px;
    }
    .score-value{
      font-size:26px;
      font-weight:800;
      letter-spacing:.03em;
    }
    .serve-indicator{
      width:14px;
      height:14px;
      border-radius:999px;
      border:2px solid rgba(69,213,107,.28);
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .serve-dot{
      width:6px;
      height:6px;
      border-radius:50%;
      background:var(--serve);
      box-shadow:0 0 10px rgba(69,213,107,.9);
    }
    .score-box.sp{
      outline:2px solid var(--accent);
      outline-offset:0;
    }
    .score-box.mp{
      outline:2px solid #ff4b6a;
    }
    .summary{
      margin-top:6px;
      padding:6px 8px 0;
      font-size:11px;
      color:var(--muted);
      letter-spacing:.18em;
      text-transform:uppercase;
      display:none;
    }
    .summary.visible{display:block;}
  </style>
</head>
<body>
  <div class="root">
    <div class="score-card">
      <div class="score-inner">
        <div class="header">
          <div class="header-title" id="title">BRONZE MEDAL MATCH</div>
          <div class="header-right">
            <div class="live-pill">
              <span class="live-dot"></span>
              <span>LIVE SCORE</span>
            </div>
          </div>
        </div>
        <div class="teams" id="teams">
          <div class="team-row" id="rowA">
            <div class="pill-code" id="codeA">ITA</div>
            <div class="logo-box"><img id="logoA" /></div>
            <div class="team-name">
              <div class="team-name-short" id="shortA">ITA</div>
            </div>
            <div class="sets-pill">
              <span class="sets-label">SETS</span>
              <span class="sets-value" id="setsA">0</span>
            </div>
            <div class="score-box" id="scoreBoxA">
              <div class="score-value" id="scoreA">23</div>
              <div class="serve-indicator" id="serveA" style="visibility:hidden;">
                <div class="serve-dot"></div>
              </div>
            </div>
          </div>

          <div class="team-row" id="rowB">
            <div class="pill-code" id="codeB">USA</div>
            <div class="logo-box"><img id="logoB" /></div>
            <div class="team-name">
              <div class="team-name-short" id="shortB">USA</div>
            </div>
            <div class="sets-pill">
              <span class="sets-label">SETS</span>
              <span class="sets-value" id="setsB">1</span>
            </div>
            <div class="score-box" id="scoreBoxB">
              <div class="score-value" id="scoreB">24</div>
              <div class="serve-indicator" id="serveB" style="visibility:hidden;">
                <div class="serve-dot"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="summary" id="summary">
          <span id="summaryText">SET 1 · 25–23 · TEAM B</span>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";

    const firebaseConfig = {
      // ⬇️ Pega aquí EL MISMO CONFIG que usas en weightlifting_control.html
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const params = new URLSearchParams(location.search);
    const room = params.get("room") || "vb1";
    const stateRef = ref(db, `vb_score/${room}`);

    const $ = s => document.querySelector(s);

    function applyState(s){
      $("#title").textContent = s.matchTitle || "";
      $("#shortA").textContent = s.aShort || "";
      $("#shortB").textContent = s.bShort || "";
      $("#codeA").textContent = (s.aShort || "").toUpperCase();
      $("#codeB").textContent = (s.bShort || "").toUpperCase();
      $("#setsA").textContent = s.aSets ?? 0;
      $("#setsB").textContent = s.bSets ?? 0;
      $("#scoreA").textContent = s.aScore ?? 0;
      $("#scoreB").textContent = s.bScore ?? 0;

      // logos: prioridad archivo (dataURL), si no URL
      const aLogo = s.aLogoData || s.aLogoUrl || "";
      const bLogo = s.bLogoData || s.bLogoUrl || "";
      $("#logoA").src = aLogo;
      $("#logoB").src = bLogo;

      // serve
      $("#serveA").style.visibility = s.serve === "A" ? "visible" : "hidden";
      $("#serveB").style.visibility = s.serve === "B" ? "visible" : "hidden";

      // highlight
      $("#scoreBoxA").classList.remove("sp","mp");
      $("#scoreBoxB").classList.remove("sp","mp");
      const hl = s.highlight || "normal";
      if(hl === "spA") $("#scoreBoxA").classList.add("sp");
      if(hl === "spB") $("#scoreBoxB").classList.add("sp");
      if(hl === "mpA") $("#scoreBoxA").classList.add("mp");
      if(hl === "mpB") $("#scoreBoxB").classList.add("mp");

      // vista resumen (por ahora solo opacidad / texto fijo)
      const showSummary = s.view === "sets";
      $("#summary").classList.toggle("visible", showSummary);
      const teamsEl = $("#teams");
      if(teamsEl) teamsEl.style.opacity = showSummary ? "0.25" : "1";
    }

    let last = null;
    onValue(stateRef, snap=>{
      if(!snap.exists()) return;
      last = snap.val();
      applyState(last);
    });
  </script>
</body>
</html>
