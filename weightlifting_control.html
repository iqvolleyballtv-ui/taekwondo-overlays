<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>VB Score Control</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html,body{
      margin:0;
      padding:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:#020617;
      color:#e5e7eb;
    }
    .wrap{
      max-width:900px;
      margin:24px auto;
      padding:16px 20px 32px;
      background:#020617;
    }
    h1{
      margin:0 0 12px;
      font-size:20px;
    }
    fieldset{
      border:1px solid #111827;
      border-radius:10px;
      margin-bottom:16px;
      padding:12px 14px 10px;
    }
    legend{
      padding:0 6px;
      font-size:13px;
      text-transform:uppercase;
      color:#9ca3af;
      letter-spacing:.16em;
    }
    label{
      font-size:13px;
      display:block;
      margin-bottom:4px;
    }
    input,select,button{
      font-family:inherit;
      font-size:13px;
    }
    input[type="text"],input[type="number"],select{
      background:#020617;
      border-radius:7px;
      border:1px solid #1f2937;
      padding:5px 8px;
      color:#e5e7eb;
      outline:none;
      width:100%;
      box-sizing:border-box;
    }
    input[type="number"]{
      max-width:80px;
    }
    .row{
      display:flex;
      gap:12px;
      margin-bottom:8px;
      flex-wrap:wrap;
    }
    .col{
      flex:1;
      min-width:120px;
    }
    .buttons{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top:4px;
    }
    button{
      border-radius:999px;
      border:none;
      padding:5px 12px;
      cursor:pointer;
      background:#1d4ed8;
      color:white;
      font-weight:500;
    }
    button.secondary{
      background:#111827;
      color:#e5e7eb;
    }
    button.danger{
      background:#b91c1c;
    }
    small{
      color:#9ca3af;
    }
    .status{
      margin-top:4px;
      font-size:12px;
      color:#9ca3af;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>VB Score Control</h1>

    <fieldset>
      <legend>Conexión</legend>
      <div class="row">
        <div class="col">
          <label>Room</label>
          <input id="room" type="text" value="vb1" />
        </div>
        <div class="col" style="flex:0 0 auto;align-self:flex-end;">
          <button id="connect">Connect</button>
        </div>
      </div>
      <div class="status" id="status">Sin conectar.</div>
      <small>El overlay debe abrirse como: <code>.../vb_score_overlay.html?room=vb1</code></small>
    </fieldset>

    <fieldset>
      <legend>Partido</legend>
      <div class="row">
        <div class="col">
          <label>Título (ej. Bronze Medal Match)</label>
          <input id="matchTitle" type="text" value="Bronze Medal Match">
        </div>
        <div class="col">
          <label>Vista</label>
          <select id="viewMode">
            <option value="live">Live score</option>
            <option value="summary">Set summary</option>
          </select>
        </div>
        <div class="col">
          <label>Resaltado</label>
          <select id="highlight">
            <option value="none">Ninguno</option>
            <option value="setA">Set point Team A</option>
            <option value="setB">Set point Team B</option>
            <option value="matchA">Match point Team A</option>
            <option value="matchB">Match point Team B</option>
          </select>
        </div>
        <div class="col">
          <label>Sirve</label>
          <select id="serving">
            <option value="A">Team A</option>
            <option value="B">Team B</option>
          </select>
        </div>
      </div>
    </fieldset>

    <fieldset>
      <legend>Team A</legend>
      <div class="row">
        <div class="col">
          <label>Código corto (ej. ITA)</label>
          <input id="aShort" type="text" value="ITA">
        </div>
        <div class="col">
          <label>Nombre</label>
          <input id="aName" type="text" value="ITALY">
        </div>
        <div class="col">
          <label>Logo (URL, opcional)</label>
          <input id="aLogo" type="text" placeholder="https://...png">
        </div>
      </div>
      <div class="row">
        <div class="col">
          <label>Sets ganados</label>
          <input id="aSets" type="number" value="0" min="0">
        </div>
        <div class="col">
          <label>Puntos</label>
          <input id="aScore" type="number" value="23" min="0">
          <div class="buttons">
            <button type="button" data-inc="aScore">+1</button>
            <button type="button" data-dec="aScore" class="secondary">-1</button>
          </div>
        </div>
      </div>
    </fieldset>

    <fieldset>
      <legend>Team B</legend>
      <div class="row">
        <div class="col">
          <label>Código corto (ej. USA)</label>
          <input id="bShort" type="text" value="USA">
        </div>
        <div class="col">
          <label>Nombre</label>
          <input id="bName" type="text" value="UNITED STATES">
        </div>
        <div class="col">
          <label>Logo (URL, opcional)</label>
          <input id="bLogo" type="text" placeholder="https://...png">
        </div>
      </div>
      <div class="row">
        <div class="col">
          <label>Sets ganados</label>
          <input id="bSets" type="number" value="1" min="0">
        </div>
        <div class="col">
          <label>Puntos</label>
          <input id="bScore" type="number" value="24" min="0">
          <div class="buttons">
            <button type="button" data-inc="bScore">+1</button>
            <button type="button" data-dec="bScore" class="secondary">-1</button>
          </div>
        </div>
      </div>
    </fieldset>

    <div class="buttons">
      <button id="save">Save / Push</button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD8r0rLCLLPJx3DsNGMuvVtFuwCMBXrR9M",
      authDomain: "tkd-overlay.firebaseapp.com",
      databaseURL: "https://tkd-overlay-default-rtdb.firebaseio.com",
      projectId: "tkd-overlay",
      storageBucket: "tkd-overlay.firebasestorage.app",
      messagingSenderId: "41501920835",
      appId: "1:41501920835:web:4ccecdf129cf20619d8ef6",
      measurementId: "G-CXBJCL86EM"
    };

    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);

    const $ = id => document.getElementById(id);

    const roomInput = $("room");
    const statusEl  = $("status");
    const connectBtn= $("connect");
    const saveBtn   = $("save");

    let stateRef = null;

    function buildState(){
      return {
        matchTitle: $("matchTitle").value.trim() || "Volleyball Match",
        showSummary: $("viewMode").value === "summary",
        highlight: $("highlight").value,
        serving: $("serving").value || "A",
        teamA:{
          short: $("aShort").value.trim() || "A",
          name:  $("aName").value.trim()  || "TEAM A",
          logo:  $("aLogo").value.trim()  || ""
        },
        teamB:{
          short: $("bShort").value.trim() || "B",
          name:  $("bName").value.trim()  || "TEAM B",
          logo:  $("bLogo").value.trim()  || ""
        },
        setsWonA: Number($("aSets").value)  || 0,
        setsWonB: Number($("bSets").value)  || 0,
        scoreA:   Number($("aScore").value) || 0,
        scoreB:   Number($("bScore").value) || 0
      };
    }

    async function pushState(){
      if(!stateRef){
        alert("Conéctate primero (botón Connect).");
        return;
      }
      const state = buildState();
      await set(stateRef, state);
    }

    connectBtn.addEventListener("click", ()=>{
      const room = (roomInput.value || "vb1").trim();
      stateRef = ref(db, `vb/${room}/state`);
      statusEl.textContent = `Conectado a room "${room}". Overlay: ?room=${room}`;
      // mandamos un estado inicial
      pushState();
    });

    saveBtn.addEventListener("click", ()=>{
      pushState();
    });

    // Botones +1 / -1
    document.body.addEventListener("click",(e)=>{
      const inc = e.target.getAttribute("data-inc");
      const dec = e.target.getAttribute("data-dec");
      if(inc){
        const input = $(inc);
        input.value = (Number(input.value)||0)+1;
        pushState();
      }
      if(dec){
        const input = $(dec);
        input.value = Math.max(0,(Number(input.value)||0)-1);
        pushState();
      }
    });
  </script>
</body>
</html>
