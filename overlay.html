<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Taekwondo Overlay</title>
  <style>
    :root{ --red:#D61F1F; --blue:#1F56D6; --panel:#111827cc; --text:#F9FAFB; }
    html,body{ height:100%; margin:0; background:transparent; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial; }
    .overlay{ position:absolute; inset:0; pointer-events:none; display:grid; align-items:start; justify-items:center; }
    .bar{ margin-top:12px; display:grid; grid-template-columns:1fr auto 1fr; gap:16px; align-items:center; width:min(96vw,1200px); }
    .panel{ background:var(--panel); backdrop-filter:blur(8px); border-radius:16px; padding:10px 14px; display:flex; align-items:center; gap:12px; }
    .team{ color:var(--text); }
    .colorDot{ width:14px; height:14px; border-radius:50%; }
    .name{ font-weight:700; font-size:18px; }
    .score{ font-weight:900; font-size:44px; color:#fff; min-width:64px; text-align:center; }
    .center{ color:#fff; gap:12px; }
    .timer{ font-weight:900; font-size:36px; }
    .round{ font-weight:700; font-size:14px; padding:4px 8px; border-radius:999px; background:#0008; }
  </style>
</head>
<body>
  <div class="overlay">
    <div class="bar">
      <div class="panel team" id="redPanel">
        <div class="colorDot" style="background:var(--red)"></div>
        <div>
          <div class="name" id="redName">RED</div>
          <div>Gam-jeom: <span id="redPen">0</span></div>
        </div>
        <div class="score" id="redScore">0</div>
      </div>

      <div class="panel center">
        <div class="timer" id="timer">02:00</div>
        <div class="round" id="round">R1</div>
      </div>

      <div class="panel team" id="bluePanel">
        <div class="score" id="blueScore">0</div>
        <div>
          <div class="name" id="blueName">BLUE</div>
          <div>Gam-jeom: <span id="bluePen">0</span></div>
        </div>
        <div class="colorDot" style="background:var(--blue)"></div>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";

    // ðŸ”¥ Pega aquÃ­ tu configuraciÃ³n de Firebase
    const firebaseConfig = {
  apiKey: "AIzaSyD8r0rLLcLPJx3DsNGMuvVTfuwCMBxRPpM",
  authDomain: "tkd-overlay.firebaseapp.com",
  databaseURL: "https://tkd-overlay-default-rtdb.firebaseio.com",
  projectId: "tkd-overlay",
  storageBucket: "tkd-overlay.firebasestorage.app",
  messagingSenderId: "41501920835",
  appId: "1:41501920835:web:4ccecdf129cf20619d8ef6",
  measurementId: "G-CXBJCL86EM"
};

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const room = new URL(location.href).searchParams.get('room') || 'room1';
    const stateRef = ref(db, `tkd/${room}/state`);

    const $ = s=>document.querySelector(s);
    const pad = n=>String(n).padStart(2,"0");
    function render(state){
      $("#redName").textContent = state.redName;
      $("#blueName").textContent = state.blueName;
      $("#redScore").textContent = state.redScore;
      $("#blueScore").textContent = state.blueScore;
      $("#redPen").textContent = state.redPen;
      $("#bluePen").textContent = state.bluePen;
      $("#round").textContent = "R"+state.round;
      let t = Math.max(0, Math.floor(state.remainingMs/1000));
      $("#timer").textContent = `${pad(Math.floor(t/60))}:${pad(t%60)}`;
    }

    let live = null; // Ãºltima versiÃ³n del estado recibida
onValue(stateRef, snap => {
  if (!snap.exists()) return;
  live = snap.val();
  // Render fijo (nombres, scores, round, penalties)
  $("#redName").textContent = live.redName;
  $("#blueName").textContent = live.blueName;
  $("#redScore").textContent = live.redScore;
  $("#blueScore").textContent = live.blueScore;
  $("#redPen").textContent = live.redPen;
  $("#bluePen").textContent = live.bluePen;
  $("#round").textContent = "R" + live.round;

  // Pintar el tiempo inmediato
  tick();
});

// â€” ticker local para que el conteo se vea corriendo en Yolo â€”
const pad = n => String(n).padStart(2,"0");
function renderTimer(ms){
  ms = Math.max(0, ms|0);
  const s = Math.floor(ms/1000);
  $("#timer").textContent = `${pad(Math.floor(s/60))}:${pad(s%60)}`;
}
function tick(){
  if(!live){ return; }
  let ms = live.remainingMs;
  if(live.running && live.startedAt){
    ms = live.remainingMs - (Date.now() - live.startedAt);
  }
  renderTimer(ms);
}
// actualiza ~5 veces por segundo para que se vea fluido
setInterval(tick, 200);

  </script>
</body>
</html>
